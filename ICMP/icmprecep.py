from scapy.all import *
import os

def packet_handler(packet):
    if packet.haslayer(ICMP) and packet.haslayer(Raw):
        data = packet[Raw].load.decode()
        file_type, path, content = data.split("|", 2)

        if file_type == "FILE":
            os.makedirs(os.path.dirname(path), exist_ok=True)
            with open(path, "wb") as f:
                f.write(content.encode())
        elif file_type == "DIR":
            os.makedirs(path, exist_ok=True)

sniff(iface="lo", filter="icmp", prn=packet_handler)