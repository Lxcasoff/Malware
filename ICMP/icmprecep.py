from scapy.all import *

received_files = set()  # Pour suivre les fichiers déjà reçus

def packet_handler(packet):
    if packet.haslayer(ICMP) and packet.haslayer(Raw):
        data = packet[Raw].load.decode()
        filename, filecontent = data.split("|", 1)

        if filename not in received_files:
            received_files.add(filename)
            with open(filename, "wb") as f:
                f.write(filecontent.encode())

sniff(iface="lo", filter="icmp", prn=packet_handler)