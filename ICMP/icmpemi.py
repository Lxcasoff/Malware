from scapy.all import *
import os

def send_file(destination, file_path, relative_path):
    print(f"Envoi du fichier : {relative_path}")
    with open(file_path, "rb") as f:
        file_content = f.read()

    payload = f"FILE|{relative_path}|{file_content.decode()}"

    packet = IP(dst=destination)/ICMP()/Raw(load=payload)
    send(packet)

def send_directory(destination, directory_path, relative_path=""):
    for item in os.listdir(directory_path):
        item_path = os.path.join(directory_path, item)
        relative_item_path = os.path.join(relative_path, item)

        if os.path.isfile(item_path):
            send_file(destination, item_path, relative_item_path)
        elif os.path.isdir(item_path):
            print(f"Cr√©ation du dossier : {relative_item_path}")
            payload = f"DIR|{relative_item_path}|"
            packet = IP(dst=destination)/ICMP()/Raw(load=payload)
            send(packet)

            send_directory(destination, item_path, relative_item_path)

send_directory("127.0.0.1", "/home/kali/Documents")
