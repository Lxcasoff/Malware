from scapy.all import *
import os
import hashlib

# Définir l'adresse IP du serveur
server_ip = "127.0.0.1"

# Lire le nom du dossier à envoyer
folder_name = input("Enter the folder name: ")

# Parcourir tous les fichiers dans le dossier et ses sous-dossiers
for dirpath, dirnames, filenames in os.walk(folder_name):
    for file_name in filenames:
        file_path = os.path.join(dirpath, file_name)

        # Utiliser le nom du fichier comme titre
        title = os.path.basename(file_path)

        # Lire le contenu du fichier en mode binaire
        with open(file_path, 'rb') as file:
            content = file.read()

        # Calculer le hash du contenu
        content_hash = hashlib.sha256(content).hexdigest()

        # Calculer le nombre total de paquets
        total_packets = len(content) // 60000 + (len(content) % 60000 != 0)

        # Diviser le contenu en sous-chaînes de 60000 octets
        for i in range(0, len(content), 60000):
            chunk = content[i:i+60000]

            # Calculer le numéro de séquence du paquet
            sequence_number = i // 60000 + 1

            # Créer le paquet ICMP
            icmp_packet = IP(dst=server_ip)/ICMP()/("bob#" + content_hash + "#" + title + "#" + str(total_packets) + "#" + str(sequence_number) + "#" + chunk.decode(errors="ignore"))

            # Envoyer le paquet
            send(icmp_packet)